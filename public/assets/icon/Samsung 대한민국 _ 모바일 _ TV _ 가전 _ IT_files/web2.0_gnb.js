const webV2Gnb=function(){const $window=$(window);const $header=$("#header__navi");const $searchAreaInner=$header.find(".search__area__inner");const $pcSearchBtn=$header.find(".utility__button__search .search__btn");const $moSearchBtn=$header.find(".utility__button__search__m .search__button");const $moMenuSearchBtn=$header.find(".head__top .search__btn");const $searchOpen=$pcSearchBtn.add($moSearchBtn).add($moMenuSearchBtn);const $searchInputBox=$searchAreaInner.find(".search__input__box");const $searchInput=
$searchInputBox.find("input[type='text']");const $searchClose=$searchInputBox.find(".search__close__btn");const $searchReset=$searchInputBox.find(".search__reset__btn");const gnbInner=document.querySelector(".header__inner");const menu=gnbInner.querySelector(".menu__wrap");const mainMenuList=menu.querySelector(".menu__wrap__inner > .menu__list");const menuItems=Array.from(menu.querySelectorAll(".menuitem__l0"));const menuButton=Array.from(menu.querySelectorAll(".item__button"));const utilityWrap=
gnbInner.querySelector(".utility__wrap");const utilityBtnWrap=Array.from(utilityWrap.querySelectorAll("[class*=utility__button__]"));const mOpen=utilityWrap.querySelector(".menu__button");const mClose=menu.querySelector(".head__top .menu__close__button");const cartList=utilityWrap.querySelector(".cart__list");const userList=utilityWrap.querySelector(".user__list");const outerMask=document.querySelector(".outer__mask");const innerMask=document.querySelector(".inner__mask");let isOpenMenu=false;let pcState=
false;let moState=false;let lastMenu=null;let maskTimer;function init(){let delay=300;let resizeTimer=null;$window.on("resize",function(){clearTimeout(resizeTimer);if(!$header.hasClass("transition-none"))$header.addClass("transition-none");resizeTimer=setTimeout(function(){$header.removeClass("transition-none");changeSetting();const scrollLeft=$searchInput.scrollLeft();if(scrollLeft>0)$searchInputBox.addClass("input__overflow");else $searchInputBox.removeClass("input__overflow")},delay)});utilityBtnWrap.forEach(function(el){let buttonType=
el.dataset.name.split("__")[1];if(buttonType!="cart"&&buttonType!="user")el.addEventListener("click",function(){ultilityEvent(buttonType)})});cartList.addEventListener("mouseleave",ultilityListMouseleave);userList.addEventListener("mouseleave",ultilityListMouseleave);$header.on("keydown",".cart__list .btn:last-child, .user__list li:last-child > a",function(e){if(e.key==="Tab"&&!e.shiftKey){this.closest("[class*=utility__button__]").classList.remove("active");mask("close")}});$searchClose.on("click",
function(e){searchClose(true);if(!menu.classList.contains("active")){clearTimeout(maskTimer);maskTimer=setTimeout(function(){mask("close")},200)}}).on("keydown",function(e){if(e.key==="Tab"&&!e.shiftKey){const $anchor=getSearchAnchor();if(!$anchor.length){e.preventDefault();$searchInput.focus()}}});$searchReset.on("click",function(){searchReset();$searchInputBox.removeClass("input__overflow");$searchInput.focus()});$searchInput.on("keyup",function(e){const $this=$(this);const value=$this.val();const scrollLeft=
$this.scrollLeft();if(value.length==0)searchReset();else $searchInputBox.addClass("typing");if(scrollLeft>0)$searchInputBox.addClass("input__overflow");else $searchInputBox.removeClass("input__overflow")});$searchInput.on("keydown",function(e){if(e.key==="Tab"&&e.shiftKey){const $anchor=getSearchAnchor();e.preventDefault();if(!$anchor.length)$searchClose.focus();else $anchor.last().focus()}});$searchAreaInner.on("keydown",".search__inner__content li > a",function(e){if(e.key==="Tab"&&!e.shiftKey){const $this=
$(this);const $lastAnchor=getSearchAnchor().last();if($this[0]==$lastAnchor[0]){e.preventDefault();$searchInput.focus()}}});changeSetting();mOpen.addEventListener("click",function(){moMenuOpen();outerMask.style.display="none"});mClose.addEventListener("click",function(){moMenuClose();mOpen.focus()});$header.on("keydown",".menu__wrap .user__mypage__list li:last-child > a",function(e){if(e.key==="Tab"&&!e.shiftKey){e.preventDefault();$moMenuSearchBtn.focus()}});$moMenuSearchBtn.on("keydown",function(e){if(e.key===
"Tab"&&e.shiftKey){const lastAnchor=Array.from(this.closest(".menu__wrap").querySelectorAll(".user__mypage__list li > a")).pop();e.preventDefault();lastAnchor.focus()}});$header.on("keydown",".menuitem__l2__head .menu__prev__button",function(e){if(e.key==="Tab"&&e.shiftKey){const container=this.closest(".menuitem__l1__container");const lastCollapse=Array.from(container.querySelectorAll(".menuitem__l2__row.collapse")).pop();const lastAnchor=!lastCollapse.classList.contains("active")?lastCollapse.querySelector("a"):
Array.from(lastCollapse.querySelectorAll("li")).pop().querySelector("a");e.preventDefault();lastAnchor.focus()}});$header.on("click",".menuitem__l2__head .menu__prev__button",function(e){moDepthClose();lastMenu.focus()});$header.on("click",".menuitem__l2__head .menu__close__button",function(e){moMenuClose();mOpen.focus()});document.addEventListener("click",function(e){e.stopPropagation();let _thisNode=e.target.className;let delay=200;let isFocus=true;if(_thisNode=="outer__mask"||_thisNode=="inner__mask"){if(!$header.hasClass("open__search")&&
!menu.classList.contains("active")){$(".utility__wrap").find("[class*=__button]").removeClass("active");delay=0}else{if(menu.classList.contains("active")){isFocus=false;moMenuClose();mOpen.focus()}searchClose(isFocus)}maskTimer=setTimeout(function(){mask("close")},delay)}})}function setAttr(viewport){if(viewport=="mo"){menu.setAttribute("aria-hidden",true);menu.setAttribute("tabindex",-1)}else{menu.setAttribute("aria-hidden",false);menu.removeAttribute("tabindex")}}function addEvent(viewport){if(viewport==
"mo"){menuItems.forEach(function(el){el.removeEventListener("mouseenter",pcMenuOpen);el.firstElementChild.removeEventListener("focus",pcMenuOpen)});gnbInner.removeEventListener("mouseleave",pcMenuClose);mainMenuList.removeEventListener("mouseleave",pcMenuClose);menuButton.forEach(function(el){el.addEventListener("click",moDepthOpen)});$header.on("click",".menuitem__l2__wrap .menuitem__l2__row.collapse > a",moDepthMenuToggle);$header.on("keydown",".menuitem__l2__row.collapse a",menuitemKeydown)}else{menuButton.forEach(function(el){el.removeEventListener("click",
moDepthOpen)});$header.off("click",".menuitem__l2__wrap .menuitem__l2__row.collapse > a",moDepthMenuToggle);$header.off("keydown",".menuitem__l2__row.collapse a",menuitemKeydown);menuItems.forEach(function(el,idx){el.addEventListener("mouseenter",pcMenuOpen);el.firstElementChild.addEventListener("focus",pcMenuOpen)});gnbInner.addEventListener("mouseleave",pcMenuClose);mainMenuList.addEventListener("mouseleave",pcMenuClose)}}function changeSetting(){if(device.val=="m"||device.val=="t"||window.innerWidth<
1280){if(!moState){addEvent("mo");setAttr("mo");utilityBtnReset();if($header.hasClass("open__search")){innerMask.style.display="block";outerMask.style.display="none";screenLock("lock")}moState=true;pcState=false}}else if(window.innerWidth>=1280||device.val=="p")if(!pcState){addEvent("pc");if(menu.classList.contains("active")){moMenuClose();menu.classList.remove("active");isOpenMenu=false;mask("close")}if($header.hasClass("open__search")){innerMask.style.display="none";outerMask.style.display="block";
screenLock("lock")}setAttr("pc");moState=false;pcState=true}}function mask(action,data,element){const elem=element||null;if(action=="close"){innerMask.style.display="none";outerMask.style.display="none";screenLock("unlock")}else if(device.val=="m"||device.val=="t"||window.innerWidth<1280){if(data=="cart"||data=="location"||data=="user")outerMask.style.display="block";else innerMask.style.display="block";screenLock("lock")}else if(data!=null&&data=="search"){outerMask.style.display="block";screenLock("lock")}else if(elem==
null)outerMask.style.display="block";else outerMask.style.display="block"}function screenLock(action){const option=action=="lock"?{height:"100%",overflow:"hidden"}:{height:"auto",overflow:"unset"};$("html, body").css(option)}function pcMenuOpen(e){const target=e.target.tagName=="A"?e.target.parentElement:e.target;const active=menu.querySelector(".menuitem__l0.active");const container=target.querySelector(".menuitem__l1__container");if(active!=null)active.classList.remove("active");clearTimeout(maskTimer);
$header.removeClass("close__gnb open__gnb");utilityBtnReset();if(container!=null){if(container.children.length>0){$header.addClass("open__gnb");target.classList.add("active");isOpenMenu=true;mask("open","menu",target)}}else maskTimer=setTimeout(function(){mask("close")},150)}function moMenuOpen(){menu.classList.add("active");menu.setAttribute("aria-hidden",false);menu.setAttribute("tabindex",0);menu.querySelector(".menu__wrap__inner").scrollTo(0,0);setTimeout(()=>{menu.focus()},100);isOpenMenu=true;
mask("open","menu")}function pcMenuClose(){const active=menu.querySelector(".menuitem__l0.active");if(isOpenMenu){if(active!=null){$header.removeClass("open__gnb");active.classList.remove("active");clearTimeout(maskTimer);maskTimer=setTimeout(function(){mask("close")},150)}isOpenMenu=false}}let moMenuCloseTimer;function moMenuClose(){menuItems.forEach(function(el){if(el.classList.contains("active"))el.classList.remove("active")});clearTimeout(moMenuCloseTimer);moMenuCloseTimer=setTimeout(function(){menu.classList.remove("step2",
"scroll-none")},500);menu.classList.remove("active");menu.setAttribute("aria-hidden",true);menu.setAttribute("tabindex",-1);isOpenMenu=false;if(!$header.hasClass("open__search"))mask("close")}let scrollNoneTimer;function moDepthClose(){menu.classList.remove("step2");clearTimeout(scrollNoneTimer);scrollNoneTimer=setTimeout(function(){menu.classList.remove("scroll-none")},500);menuItems.forEach(function(el){if(el.classList.contains("active"))el.classList.remove("active")})}function moDepthMenuToggle(e){e.preventDefault();
const parent=this.parentElement;const $next=$(this.nextElementSibling);if(parent.classList.contains("active")){parent.classList.remove("active");$next.stop().slideUp(500)}else{parent.classList.add("active");$next.stop().slideDown(500)}}function moDepthOpen(e){e.preventDefault();const target=e.target;const parent=target.parentElement;const container=parent.querySelector(".menuitem__l1__container");if(container==null)return;lastMenu=target;const menuWrap=parent.querySelector(".menuitem__l2__wrap");
if(menuWrap!=null){const collapse=Array.from(menuWrap.querySelectorAll(".menuitem__l2__row.collapse"));menu.classList.add("step2","scroll-none");parent.classList.add("active");collapse.forEach(function(el){if(el.classList.contains("list__thumbnail")){el.classList.add("active");el.querySelector(".menuitem__l2__list").style.display="block"}else{el.classList.remove("active");el.querySelector(".menuitem__l2__list").style.display="none"}});menuWrap.scrollTo(0,0)}}function menuitemKeydown(e){if(e.key===
"Tab"&&!e.shiftKey){const container=this.closest(".menuitem__l1__container");const lastCollapse=Array.from(container.querySelectorAll(".menuitem__l2__row.collapse")).pop();const depth2LastAnchor=lastCollapse.querySelector("a");const depth3LastAnchor=Array.from(lastCollapse.querySelectorAll("li")).pop().querySelector("a");if(depth2LastAnchor==this&&!lastCollapse.classList.contains("active")||depth3LastAnchor==this&&lastCollapse.classList.contains("active")){e.preventDefault();container.querySelector(".menu__prev__button").focus()}}}
let searchOpenFocusTimer=null;function searchOpen(){utilityBtnReset();pcMenuClose();if(!$header.hasClass("open__search")){$header.addClass("open__search");clearTimeout(maskTimer);clearTimeout(searchOpenFocusTimer);searchOpenFocusTimer=setTimeout(function(){$searchInput.focus()},400);mask("open","search")}}let searchTimer=null;function searchClose(isFocus){$header.removeClass("open__search").addClass("close__search");clearTimeout(searchTimer);searchTimer=setTimeout(function(){if($header.hasClass("close__search"))$header.removeClass("close__search");
searchReset()},300);if((device.val=="m"||device.val=="t"||window.innerWidth<1280)&&isFocus)if(menu.classList.contains("active"))$moMenuSearchBtn.focus();else $moSearchBtn.focus();else $pcSearchBtn.focus()}function searchReset(){$searchInputBox.removeClass("typing");$searchInput.val("");$searchAreaInner.removeClass("result none")}function getSearchAnchor(){const parentSelector=$searchAreaInner.hasClass("result")?".content__result":$searchAreaInner.hasClass("none")?".content__result .content__view__left":
".content__basic";return $searchAreaInner.find(parentSelector+" li > a")}function ultilityListMouseleave(){this.parentElement.classList.remove("active");mask("close")}function utilityBtnReset(){utilityBtnWrap.forEach(function(el){el.classList.remove("active")})}function ultilityEvent(buttonType){let btnType=buttonType=="menu"?buttonType+"__m":buttonType;utilityBtnReset();pcMenuClose();utilityWrap.querySelector(".utility__button__"+btnType).classList.add("active");switch(buttonType){case "back":return false;
case "home":return false;case "search":return false;case "location":return false;case "barcode":mask("close");return false;case "cart":break;case "user":break;case "menu":return false;default:break}mask("open",buttonType)}return{init:init,changeSetting:changeSetting,pcMenuOpen:pcMenuOpen,moDepthOpen:moDepthOpen,searchOpen:searchOpen,ultilityEvent:ultilityEvent}}();window.addEventListener("DOMContentLoaded",function(){webV2Gnb.init()});
